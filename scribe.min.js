!function(e){var n={};(function(){function e(){}function t(e,n){for(var t=e.length;t--;)if(e[t].listener===n)return t;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var o=e.prototype,i=this,a=i.EventEmitter;o.getListeners=function(e){var n,t,r=this._getEvents();if(e instanceof RegExp){n={};for(t in r)r.hasOwnProperty(t)&&e.test(t)&&(n[t]=r[t])}else n=r[e]||(r[e]=[]);return n},o.flattenListeners=function(e){var n,t=[];for(n=0;n<e.length;n+=1)t.push(e[n].listener);return t},o.getListenersAsObject=function(e){var n,t=this.getListeners(e);return t instanceof Array&&(n={},n[e]=t),n||t},o.addListener=function(e,n){var r,o=this.getListenersAsObject(e),i="object"==typeof n;for(r in o)o.hasOwnProperty(r)&&-1===t(o[r],n)&&o[r].push(i?n:{listener:n,once:!1});return this},o.on=r("addListener"),o.addOnceListener=function(e,n){return this.addListener(e,{listener:n,once:!0})},o.once=r("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var n=0;n<e.length;n+=1)this.defineEvent(e[n]);return this},o.removeListener=function(e,n){var r,o,i=this.getListenersAsObject(e);for(o in i)i.hasOwnProperty(o)&&(r=t(i[o],n),-1!==r&&i[o].splice(r,1));return this},o.off=r("removeListener"),o.addListeners=function(e,n){return this.manipulateListeners(!1,e,n)},o.removeListeners=function(e,n){return this.manipulateListeners(!0,e,n)},o.manipulateListeners=function(e,n,t){var r,o,i=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof n||n instanceof RegExp)for(r=t.length;r--;)i.call(this,n,t[r]);else for(r in n)n.hasOwnProperty(r)&&(o=n[r])&&("function"==typeof o?i.call(this,r,o):a.call(this,r,o));return this},o.removeEvent=function(e){var n,t=typeof e,r=this._getEvents();if("string"===t)delete r[e];else if(e instanceof RegExp)for(n in r)r.hasOwnProperty(n)&&e.test(n)&&delete r[n];else delete this._events;return this},o.removeAllListeners=r("removeEvent"),o.emitEvent=function(e,n){var t,r,o,i,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].length;r--;)t=a[o][r],t.once===!0&&this.removeListener(e,t.listener),i=t.listener.apply(this,n||[]),i===this._getOnceReturnValue()&&this.removeListener(e,t.listener);return this},o.trigger=r("emitEvent"),o.emit=function(e){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,n)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=a,e},n.event_emitter=function(){return e}()}).call(this),n.lodash_modern_internals_isNative=function(){function e(e){return"function"==typeof e&&r.test(e)}var n=Object.prototype,t=n.toString,r=RegExp("^"+String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return e}(),n.lodash_modern_internals_objectTypes=function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return e}(),n.lodash_modern_objects_isObject=function(e){function n(n){return!(!n||!e[typeof n])}return n}(n.lodash_modern_internals_objectTypes),n.lodash_modern_internals_shimKeys=function(e){var n=Object.prototype,t=n.hasOwnProperty,r=function(n){var r,o=n,i=[];if(!o)return i;if(!e[typeof n])return i;for(r in o)t.call(o,r)&&i.push(r);return i};return r}(n.lodash_modern_internals_objectTypes),n.lodash_modern_objects_keys=function(e,n,t){var r=e(r=Object.keys)&&r,o=r?function(e){return n(e)?r(e):[]}:t;return o}(n.lodash_modern_internals_isNative,n.lodash_modern_objects_isObject,n.lodash_modern_internals_shimKeys),n.lodash_modern_objects_defaults=function(e,n){var t=function(t,r,o){var i,a=t,s=a;if(!a)return s;for(var c=arguments,u=0,l="number"==typeof o?2:c.length;++u<l;)if(a=c[u],a&&n[typeof a])for(var d=-1,m=n[typeof a]&&e(a),p=m?m.length:0;++d<p;)i=m[d],"undefined"==typeof s[i]&&(s[i]=a[i]);return s};return t}(n.lodash_modern_objects_keys,n.lodash_modern_internals_objectTypes),n.plugins_core_commands_indent=function(){return function(){return function(e){var n=new e.api.Command("indent");n.queryEnabled=function(){var n=new e.api.Selection,t=n.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!t},e.commands.indent=n}}}(),n.lodash_modern_utilities_noop=function(){function e(){}return e}(),n.lodash_modern_internals_baseCreate=function(e,n){function t(e){return n(e)?r(e):{}}var r=e(r=Object.create)&&r;return r||(t=function(){function e(){}return function(t){if(n(t)){e.prototype=t;var r=new e;e.prototype=null}return r||window.Object()}}()),t}(n.lodash_modern_internals_isNative,n.lodash_modern_objects_isObject,n.lodash_modern_utilities_noop),n.lodash_modern_internals_setBindData=function(e,n){var t={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var n={},t=e(t=Object.defineProperty)&&t,r=t(n,n,n)&&t}catch(o){}return r}(),o=r?function(e,n){t.value=n,r(e,"__bindData__",t)}:n;return o}(n.lodash_modern_internals_isNative,n.lodash_modern_utilities_noop),n.lodash_modern_internals_slice=function(){function e(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(0>o?0:o);++r<o;)i[r]=e[n+r];return i}return e}(),n.lodash_modern_internals_baseBind=function(e,n,t,r){function o(o){function i(){if(c){var t=r(c);a.apply(t,arguments)}if(this instanceof i){var o=e(s.prototype),l=s.apply(o,t||arguments);return n(l)?l:o}return s.apply(u,t||arguments)}var s=o[0],c=o[2],u=o[4];return t(i,o),i}var i=[],a=i.push;return o}(n.lodash_modern_internals_baseCreate,n.lodash_modern_objects_isObject,n.lodash_modern_internals_setBindData,n.lodash_modern_internals_slice),n.lodash_modern_internals_baseCreateWrapper=function(e,n,t,r){function o(i){function s(){var t=f?m:this;if(l){var i=r(l);a.apply(i,arguments)}if((d||h)&&(i||(i=r(arguments)),d&&a.apply(i,d),h&&i.length<p))return u|=16,o([c,g?u:-4&u,i,null,m,p]);if(i||(i=arguments),_&&(c=t[y]),this instanceof s){t=e(c.prototype);var v=c.apply(t,i);return n(v)?v:t}return c.apply(t,i)}var c=i[0],u=i[1],l=i[2],d=i[3],m=i[4],p=i[5],f=1&u,_=2&u,h=4&u,g=8&u,y=c;return t(s,i),s}var i=[],a=i.push;return o}(n.lodash_modern_internals_baseCreate,n.lodash_modern_objects_isObject,n.lodash_modern_internals_setBindData,n.lodash_modern_internals_slice),n.lodash_modern_objects_isFunction=function(){function e(e){return"function"==typeof e}return e}(),n.lodash_modern_internals_createWrapper=function(e,n,t,r){function o(i,c,u,l,d,m){var p=1&c,f=2&c,_=4&c,h=16&c,g=32&c;if(!f&&!t(i))throw new TypeError;h&&!u.length&&(c&=-17,h=u=!1),g&&!l.length&&(c&=-33,g=l=!1);var y=i&&i.__bindData__;if(y&&y!==!0)return y=r(y),y[2]&&(y[2]=r(y[2])),y[3]&&(y[3]=r(y[3])),!p||1&y[1]||(y[4]=d),!p&&1&y[1]&&(c|=8),!_||4&y[1]||(y[5]=m),h&&a.apply(y[2]||(y[2]=[]),u),g&&s.apply(y[3]||(y[3]=[]),l),y[1]|=c,o.apply(null,y);var v=1==c||17===c?e:n;return v([i,c,u,l,d,m])}var i=[],a=i.push,s=i.unshift;return o}(n.lodash_modern_internals_baseBind,n.lodash_modern_internals_baseCreateWrapper,n.lodash_modern_objects_isFunction,n.lodash_modern_internals_slice),n.lodash_modern_functions_bind=function(e,n){function t(t,r){return arguments.length>2?e(t,17,n(arguments,2),null,r):e(t,1,null,null,r)}return t}(n.lodash_modern_internals_createWrapper,n.lodash_modern_internals_slice),n.lodash_modern_utilities_identity=function(){function e(e){return e}return e}(),n.lodash_modern_support=function(e){var n=/\bthis\b/,t={};return t.funcDecomp=!e(window.WinRTError)&&n.test(function(){return this}),t.funcNames="string"==typeof Function.name,t}(n.lodash_modern_internals_isNative),n.lodash_modern_internals_baseCreateCallback=function(e,n,t,r){function o(o,c,u){if("function"!=typeof o)return n;if("undefined"==typeof c||!("prototype"in o))return o;var l=o.__bindData__;if("undefined"==typeof l&&(r.funcNames&&(l=!o.name),l=l||!r.funcDecomp,!l)){var d=s.call(o);r.funcNames||(l=!i.test(d)),l||(l=a.test(d),t(o,l))}if(l===!1||l!==!0&&1&l[1])return o;switch(u){case 1:return function(e){return o.call(c,e)};case 2:return function(e,n){return o.call(c,e,n)};case 3:return function(e,n,t){return o.call(c,e,n,t)};case 4:return function(e,n,t,r){return o.call(c,e,n,t,r)}}return e(o,c)}var i=/^\s*function[ \n\r\t]+\w/,a=/\bthis\b/,s=Function.prototype.toString;return o}(n.lodash_modern_functions_bind,n.lodash_modern_utilities_identity,n.lodash_modern_internals_setBindData,n.lodash_modern_support),n.lodash_modern_objects_forIn=function(e,n){var t=function(t,r,o){var i,a=t,s=a;if(!a)return s;if(!n[typeof a])return s;r=r&&"undefined"==typeof o?r:e(r,o,3);for(i in a)if(r(a[i],i,t)===!1)return s;return s};return t}(n.lodash_modern_internals_baseCreateCallback,n.lodash_modern_internals_objectTypes),n.lodash_modern_internals_arrayPool=function(){var e=[];return e}(),n.lodash_modern_internals_getArray=function(e){function n(){return e.pop()||[]}return n}(n.lodash_modern_internals_arrayPool),n.lodash_modern_internals_maxPoolSize=function(){var e=40;return e}(),n.lodash_modern_internals_releaseArray=function(e,n){function t(t){t.length=0,e.length<n&&e.push(t)}return t}(n.lodash_modern_internals_arrayPool,n.lodash_modern_internals_maxPoolSize),n.lodash_modern_internals_baseIsEqual=function(e,n,t,r,o){function i(f,g,y,v,b,C){if(y){var E=y(f,g);if("undefined"!=typeof E)return!!E}if(f===g)return 0!==f||1/f==1/g;var N=typeof f,L=typeof g;if(!(f!==f||f&&r[N]||g&&r[L]))return!1;if(null==f||null==g)return f===g;var w=_.call(f),k=_.call(g);if(w==a&&(w=d),k==a&&(k=d),w!=k)return!1;switch(w){case c:case u:return+f==+g;case l:return f!=+f?g!=+g:0==f?1/f==1/g:f==+g;case m:case p:return f==String(g)}var M=w==s;if(!M){var x=h.call(f,"__wrapped__"),S=h.call(g,"__wrapped__");if(x||S)return i(x?f.__wrapped__:f,S?g.__wrapped__:g,y,v,b,C);if(w!=d)return!1;var j=f.constructor,T=g.constructor;if(j!=T&&!(t(j)&&j instanceof j&&t(T)&&T instanceof T)&&"constructor"in f&&"constructor"in g)return!1}var O=!b;b||(b=n()),C||(C=n());for(var A=b.length;A--;)if(b[A]==f)return C[A]==g;var H=0;if(E=!0,b.push(f),C.push(g),M){if(A=f.length,H=g.length,E=H==A,E||v)for(;H--;){var P=A,B=g[H];if(v)for(;P--&&!(E=i(f[P],B,y,v,b,C)););else if(!(E=i(f[H],B,y,v,b,C)))break}}else e(g,function(e,n,t){return h.call(t,n)?(H++,E=h.call(f,n)&&i(f[n],e,y,v,b,C)):void 0}),E&&!v&&e(f,function(e,n,t){return h.call(t,n)?E=--H>-1:void 0});return b.pop(),C.pop(),O&&(o(b),o(C)),E}var a="[object Arguments]",s="[object Array]",c="[object Boolean]",u="[object Date]",l="[object Number]",d="[object Object]",m="[object RegExp]",p="[object String]",f=Object.prototype,_=f.toString,h=f.hasOwnProperty;return i}(n.lodash_modern_objects_forIn,n.lodash_modern_internals_getArray,n.lodash_modern_objects_isFunction,n.lodash_modern_internals_objectTypes,n.lodash_modern_internals_releaseArray),n.lodash_modern_utilities_property=function(){function e(e){return function(n){return n[e]}}return e}(),n.lodash_modern_functions_createCallback=function(e,n,t,r,o){function i(i,a,s){var c=typeof i;if(null==i||"function"==c)return e(i,a,s);if("object"!=c)return o(i);var u=r(i),l=u[0],d=i[l];return 1!=u.length||d!==d||t(d)?function(e){for(var t=u.length,r=!1;t--&&(r=n(e[u[t]],i[u[t]],null,!0)););return r}:function(e){var n=e[l];return d===n&&(0!==d||1/d==1/n)}}return i}(n.lodash_modern_internals_baseCreateCallback,n.lodash_modern_internals_baseIsEqual,n.lodash_modern_objects_isObject,n.lodash_modern_objects_keys,n.lodash_modern_utilities_property),n.lodash_modern_arrays_last=function(e,n){function t(t,i,a){var s=0,c=t?t.length:0;if("number"!=typeof i&&null!=i){var u=c;for(i=e(i,a,3);u--&&i(t[u],u,t);)s++}else if(s=i,null==s||a)return t?t[c-1]:r;return n(t,o(0,c-s))}var r,o=Math.max;return t}(n.lodash_modern_functions_createCallback,n.lodash_modern_internals_slice),n.lodash_modern_internals_baseIndexOf=function(){function e(e,n,t){for(var r=(t||0)-1,o=e?e.length:0;++r<o;)if(e[r]===n)return r;return-1}return e}(),n.lodash_modern_objects_forOwn=function(e,n,t){var r=function(r,o,i){var a,s=r,c=s;if(!s)return c;if(!t[typeof s])return c;o=o&&"undefined"==typeof i?o:e(o,i,3);for(var u=-1,l=t[typeof s]&&n(s),d=l?l.length:0;++u<d;)if(a=l[u],o(s[a],a,r)===!1)return c;return c};return r}(n.lodash_modern_internals_baseCreateCallback,n.lodash_modern_objects_keys,n.lodash_modern_internals_objectTypes),n.lodash_modern_objects_isArray=function(e){var n="[object Array]",t=Object.prototype,r=t.toString,o=e(o=Array.isArray)&&o,i=o||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&r.call(e)==n||!1};return i}(n.lodash_modern_internals_isNative),n.lodash_modern_objects_isString=function(){function e(e){return"string"==typeof e||e&&"object"==typeof e&&r.call(e)==n||!1}var n="[object String]",t=Object.prototype,r=t.toString;return e}(),n.lodash_modern_collections_contains=function(e,n,t,r){function o(o,a,s){var c=-1,u=e,l=o?o.length:0,d=!1;return s=(0>s?i(0,l+s):s)||0,t(o)?d=u(o,a,s)>-1:"number"==typeof l?d=(r(o)?o.indexOf(a,s):u(o,a,s))>-1:n(o,function(e){return++c>=s?!(d=e===a):void 0}),d}var i=Math.max;return o}(n.lodash_modern_internals_baseIndexOf,n.lodash_modern_objects_forOwn,n.lodash_modern_objects_isArray,n.lodash_modern_objects_isString),n.plugins_core_commands_insert_html=function(e,n){return function(){return function(t){function r(e){return n(o,e.nodeName)}var o=["P","LI","DIV","BLOCKQUOTE","UL","OL","H2"],i=new t.api.Command("insertHTML");i.execute=function(n){t.allowsBlockElements()?t.transactionManager.run(function(){function o(n){var t=Array.prototype.reduce.call(n.childNodes,function(n,t){function o(){var e=[t];n.push(e)}var i=e(n);if(i){var a=r(i[0]);a===r(t)?i.push(t):o()}else o();return n},[]),o=t.filter(function(e){var n=r(e[0]);return!n});o.forEach(function(e){var n=document.createElement("p");e[0].parentNode.insertBefore(n,e[0]),e.forEach(function(e){n.appendChild(e)})}),n._isWrapped=!0}function i(e){for(var n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),t=n.firstChild();t;){if("BLOCKQUOTE"===t.nodeName&&!t._isWrapped){o(t),i(e);break}t=n.nextSibling()}}var a=document.createElement("div");a.innerHTML=n,o(a),i(a);var s=a.innerHTML;t.api.Command.prototype.execute.call(this,s)}.bind(this)):t.api.Command.prototype.execute.call(this,n)},t.commands.insertHTML=i}}}(n.lodash_modern_arrays_last,n.lodash_modern_collections_contains),n.plugins_core_commands_insert_list=function(){return function(){return function(e){var n=function(n){e.api.Command.call(this,n)};n.prototype=Object.create(e.api.Command.prototype),n.prototype.constructor=n,n.prototype.execute=function(n){function t(e){if(e.length>0){var n=document.createElement(i.nodeName);e.forEach(function(e){n.appendChild(e)}),i.parentNode.insertBefore(n,i.nextElementSibling)}}if(this.queryState()){var r=new e.api.Selection,o=r.range,i=r.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName}),a=r.getContaining(function(e){return"LI"===e.nodeName});e.transactionManager.run(function(){if(a){var n=new e.api.Node(a).nextAll();t(n),r.placeMarkers();var s=document.createElement("p");s.innerHTML=a.innerHTML,i.parentNode.insertBefore(s,i.nextElementSibling),a.parentNode.removeChild(a)}else{var c=Array.prototype.map.call(i.querySelectorAll("li"),function(e){return o.intersectsNode(e)&&e}).filter(function(e){return e}),u=c.slice(-1)[0],l=new e.api.Node(u).nextAll();t(l),r.placeMarkers();var d=document.createDocumentFragment();c.forEach(function(e){var n=document.createElement("p");n.innerHTML=e.innerHTML,d.appendChild(n)}),i.parentNode.insertBefore(d,i.nextElementSibling),c.forEach(function(e){e.parentNode.removeChild(e)})}0===i.childNodes.length&&i.parentNode.removeChild(i),r.selectMarkers()}.bind(this))}else e.api.Command.prototype.execute.call(this,n)},n.prototype.queryEnabled=function(){return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()},e.commands.insertOrderedList=new n("insertOrderedList"),e.commands.insertUnorderedList=new n("insertUnorderedList")}}}(),n.plugins_core_commands_outdent=function(){return function(){return function(e){var n=new e.api.Command("outdent");n.queryEnabled=function(){var n=new e.api.Selection,t=n.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!t},e.commands.outdent=n}}}(),n.plugins_core_commands_redo=function(){return function(){return function(e){var n=new e.api.Command("redo");n.execute=function(){var n=e.undoManager.redo();"undefined"!=typeof n&&e.restoreFromHistory(n)},n.queryEnabled=function(){return e.undoManager.position<e.undoManager.stack.length-1},e.commands.redo=n,e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&90===e.keyCode&&(e.preventDefault(),n.execute())})}}}(),n.plugins_core_commands_undo=function(){return function(){return function(e){var n=new e.api.Command("undo");n.execute=function(){var n=e.undoManager.undo();"undefined"!=typeof n&&e.restoreFromHistory(n)},n.queryEnabled=function(){return e.undoManager.position>1},e.commands.undo=n,e.el.addEventListener("keydown",function(e){e.shiftKey||!e.metaKey&&!e.ctrlKey||90!==e.keyCode||(e.preventDefault(),n.execute())})}}}(),n.plugins_core_commands=function(e,n,t,r,o,i){return{indent:e,insertHTML:n,insertList:t,outdent:r,redo:o,undo:i}}(n.plugins_core_commands_indent,n.plugins_core_commands_insert_html,n.plugins_core_commands_insert_list,n.plugins_core_commands_outdent,n.plugins_core_commands_redo,n.plugins_core_commands_undo),n.plugins_core_events=function(e){return function(){return function(n){n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode){var t=new n.api.Selection,r=t.range,o=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(o&&r.collapsed){var i=r.cloneRange();i.setEndAfter(o,0);var a=i.cloneContents();""===a.firstChild.textContent&&(e.preventDefault(),n.transactionManager.run(function(){var e=document.createElement("p"),n=document.createElement("br");e.appendChild(n),o.parentNode.insertBefore(e,o.nextElementSibling),r.setStart(e,0),r.setEnd(e,0),t.selection.removeAllRanges(),t.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode||8===e.keyCode){var t=new n.api.Selection,r=t.range;if(r.collapsed){var o=t.getContaining(function(e){return"LI"===e.nodeName});if(o&&""===o.textContent.trim()){e.preventDefault();var i=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName}),a=n.getCommand("OL"===i.nodeName?"insertOrderedList":"insertUnorderedList");a.execute()}}}}),n.el.addEventListener("paste",function(t){if(t.clipboardData)t.preventDefault(),e(t.clipboardData.types,"text/html")?n.insertHTML(t.clipboardData.getData("text/html")):n.insertPlainText(t.clipboardData.getData("text/plain"));else{var r=new n.api.Selection;r.placeMarkers();var o=document.createElement("div");document.body.appendChild(o),o.setAttribute("contenteditable",!0),o.focus(),setTimeout(function(){data=o.innerHTML,o.parentNode.removeChild(o),r.selectMarkers(),n.el.focus(),n.insertHTML(data)},1)}})}}}(n.lodash_modern_collections_contains),n.plugins_core_formatters_html_replace_nbsp_chars=function(){return function(){return function(e){var n="&nbsp;| ",t=new RegExp(n,"g");e.htmlFormatter.formatters.push(function(e){return e.replace(t," ")})}}}(),n.lodash_modern_internals_htmlEscapes=function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e}(),n.lodash_modern_internals_escapeHtmlChar=function(e){function n(n){return e[n]}return n}(n.lodash_modern_internals_htmlEscapes),n.lodash_modern_internals_reUnescapedHtml=function(e,n){var t=RegExp("["+n(e).join("")+"]","g");return t}(n.lodash_modern_internals_htmlEscapes,n.lodash_modern_objects_keys),n.lodash_modern_utilities_escape=function(e,n,t){function r(n){return null==n?"":String(n).replace(t,e)}return r}(n.lodash_modern_internals_escapeHtmlChar,n.lodash_modern_objects_keys,n.lodash_modern_internals_reUnescapedHtml),n.plugins_core_formatters_plain_text_escape_html_characters=function(e){return function(){return function(n){n.plainTextFormatter.formatters.push(e)}}}(n.lodash_modern_utilities_escape),n.plugins_core_inline_elements_mode=function(){function e(e){for(var n=document.createTreeWalker(e);n.nextNode();)if(n.currentNode&&(~["br"].indexOf(n.currentNode.nodeName.toLowerCase())||n.currentNode.length>0))return!0;return!1}return function(){return function(n){n.el.addEventListener("keydown",function(t){if(13===t.keyCode){var r=new n.api.Selection,o=r.range,i=r.getContaining(function(e){return"LI"===e.nodeName||/^(H[1-6])$/.test(e.nodeName)});i||(t.preventDefault(),n.transactionManager.run(function(){"BR"===n.el.lastChild.nodeName&&n.el.removeChild(n.el.lastChild);var t=document.createElement("br");o.insertNode(t),o.collapse(!1);var i=o.cloneRange();i.setEndAfter(n.el.lastChild,0);var a=i.cloneContents();if(!e(a)){var s=document.createElement("br");o.insertNode(s)}var c=o.cloneRange();c.setStartAfter(t,0),c.setEndAfter(t,0),r.selection.removeAllRanges(),r.selection.addRange(c)}))}}.bind(this)),""===n.getHTML().trim()&&n.setContent("")}}}(),n.plugins_core_patches_commands_bold=function(){return function(){return function(e){var n=new e.api.CommandPatch("bold");n.queryEnabled=function(){var n=new e.api.Selection,t=n.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!t},e.commandPatches.bold=n}}}(),n.plugins_core_patches_commands_indent=function(){var e="﻿";return function(){return function(n){var t=new n.api.CommandPatch("indent");t.execute=function(t){n.transactionManager.run(function(){var r=new n.api.Selection,o=r.range,i="P"===o.commonAncestorContainer.nodeName&&"<br>"===o.commonAncestorContainer.innerHTML;if(i){var a=document.createTextNode(e);o.insertNode(a),o.setStart(a,0),o.setEnd(a,0),r.selection.removeAllRanges(),r.selection.addRange(o)}n.api.CommandPatch.prototype.execute.call(this,t),r=new n.api.Selection;var s=r.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});s&&s.removeAttribute("style")}.bind(this))},n.commandPatches.indent=t}}}(),n.plugins_core_patches_commands_insert_html=function(){return function(){return function(e){var n=new e.api.CommandPatch("insertHTML");n.execute=function(n){e.transactionManager.run(function(){function t(n){var r=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT),o=r.firstChild();if(o)do"SPAN"===o.nodeName?new e.api.Element(n).unwrap(o):(o.style.lineHeight=null,""===o.getAttribute("style")&&o.removeAttribute("style")),t(o);while(o=r.nextSibling())}e.api.CommandPatch.prototype.execute.call(this,n),t(e.el)}.bind(this))},e.commandPatches.insertHTML=n}}}(),n.plugins_core_patches_commands_insert_list=function(){return function(){return function(e){var n=function(n){e.api.CommandPatch.call(this,n)};n.prototype=Object.create(e.api.CommandPatch.prototype),n.prototype.constructor=n,n.prototype.execute=function(n){e.transactionManager.run(function(){if(e.api.CommandPatch.prototype.execute.call(this,n),this.queryState()){var t=new e.api.Selection,r=t.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName});if(r){var o=r.parentNode;o&&/^(H[1-6]|P)$/.test(o.nodeName)&&(t.placeMarkers(),o.parentNode.insertBefore(r,o.nextElementSibling),t.selectMarkers(),o.parentNode.removeChild(o))}var i=Array.prototype.slice.call(r.childNodes);i.forEach(function(n){var t=Array.prototype.slice.call(n.childNodes);t.forEach(function(t){if("SPAN"===t.nodeName){var r=t;new e.api.Element(n).unwrap(r)}else t.nodeType===Node.ELEMENT_NODE&&(t.style.lineHeight=null,""===t.getAttribute("style")&&t.removeAttribute("style"))})})}}.bind(this))},e.commandPatches.insertOrderedList=new n("insertOrderedList"),e.commandPatches.insertUnorderedList=new n("insertUnorderedList")}}}(),n.plugins_core_patches_commands_outdent=function(){return function(){return function(e){var n=new e.api.CommandPatch("outdent");n.execute=function(){e.transactionManager.run(function(){var n=new e.api.Selection,t=n.range;if("BLOCKQUOTE"===t.commonAncestorContainer.nodeName){var r=t.commonAncestorContainer;n.placeMarkers(),n.selectMarkers(!0);var o=t.cloneContents();r.parentNode.insertBefore(o,r),t.deleteContents(),n.selectMarkers(),""===r.textContent&&r.parentNode.removeChild(r)}else{var i=n.getContaining(function(e){return"P"===e.nodeName});if(i){var r=n.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName}),a=new e.api.Node(i).nextAll();if(a.length){var s=document.createElement(r.nodeName);a.forEach(function(e){s.appendChild(e)}),r.parentNode.insertBefore(s,r.nextElementSibling)}n.placeMarkers(),r.parentNode.insertBefore(i,r.nextElementSibling),n.selectMarkers(),""===r.innerHTML&&r.parentNode.removeChild(r)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=n}}}(),n.plugins_core_patches_empty_when_deleting=function(){return function(){return function(e){function n(e){var n=document.createElement("div"),t=e.cloneContents();return n.appendChild(t),n.innerHTML}function t(t){var r=n(t),o=document.createRange();o.selectNodeContents(e.el);var i=n(o);return r===i}e.el.addEventListener("keydown",function(n){if(8===n.keyCode||46===n.keyCode){var r=new e.api.Selection,o=r.selection.isCollapsed,i=t(r.range);(o&&""===e.getTextContent().trim()||!o&&i)&&(n.preventDefault(),e.transactionManager.run(function(){e.setHTML('<p><em class="scribe-marker"></em><br></p>'),r.selectMarkers()}))}})}}}(),n.plugins_core_patches_events=function(){return function(){return function(e){e.allowsBlockElements()&&e.el.addEventListener("keyup",function(n){if(8===n.keyCode||46===n.keyCode){var t=new e.api.Selection,r=(t.range,t.getContaining(function(e){return"P"===e.nodeName}));r&&(e.undoManager.undo(),e.transactionManager.run(function(){t.placeMarkers();var n=Array.prototype.slice.call(r.childNodes);n.forEach(function(n){if("SPAN"===n.nodeName){var t=n;new e.api.Element(r).unwrap(t)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,""===n.getAttribute("style")&&n.removeAttribute("style"))}),t.selectMarkers()}))}})}}}(),n.plugins_core_patches=function(e,n,t,r,o,i,a){return{commands:{bold:e,indent:n,insertHTML:t,insertList:r,outdent:o},emptyWhenDeleting:i,events:a}}(n.plugins_core_patches_commands_bold,n.plugins_core_patches_commands_indent,n.plugins_core_patches_commands_insert_html,n.plugins_core_patches_commands_insert_list,n.plugins_core_patches_commands_outdent,n.plugins_core_patches_empty_when_deleting,n.plugins_core_patches_events),n.plugins_core_set_root_p_element=function(){return function(){return function(e){""===e.getHTML().trim()&&e.setContent("<p><br></p>")}}}(),n.api_command_patch=function(){return function(e){function n(e){this.commandName=e}return n.prototype.execute=function(n){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,n||null)}.bind(this))},n.prototype.queryState=function(){return document.queryCommandState(this.commandName)},n.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},n}}(),n.api_command=function(){return function(e){function n(n){this.commandName=n,this.patch=e.commandPatches[this.commandName]}return n.prototype.execute=function(n){this.patch?this.patch.execute(n):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,n||null)}.bind(this))},n.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},n.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},n}}(),n.api_node=function(){function e(e){this.node=e}return e.prototype.getAncestor=function(e){var n=function(e){return e&&e.attributes&&e.attributes.getNamedItem("contenteditable")};if(!n(this.node))for(var t=this.node.parentNode;t&&!n(t);){if(e(t))return t;t=t.parentNode}},e.prototype.nextAll=function(){for(var e=[],n=this.node;n=n.nextSibling;)e.push(n);return e},e}(),n.api_element=function(e){function n(n){e.call(this,n)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.unwrap=function(e){for(;e.childNodes.length>0;)this.node.insertBefore(e.childNodes[0],e);this.node.removeChild(e)},n}(n.api_node),n.api_selection=function(){return function(e){function n(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return n.prototype.getContaining=function(n){var t=new e.api.Node(this.range.commonAncestorContainer),r=t.node&&t.node.attributes&&t.node.attributes.getNamedItem("contenteditable");return!r&&n(t.node)?t.node:t.getAncestor(n)},n.prototype.placeMarkers=function(){var e=document.createElement("em");e.classList.add("scribe-marker");var n=document.createElement("em");n.classList.add("scribe-marker");var t=this.range.cloneRange();if(t.collapse(!1),t.insertNode(n),n.nextSibling&&3===n.nextSibling.nodeType&&""===n.nextSibling.data&&n.parentNode.removeChild(n.nextSibling),!this.range.collapsed){var r=this.range.cloneRange();r.collapse(!0),r.insertNode(e),e.nextSibling&&3===e.nextSibling.nodeType&&""===e.nextSibling.data&&e.parentNode.removeChild(e.nextSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)},n.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},n.prototype.removeMarkers=function(){var e=this.getMarkers();Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})},n.prototype.selectMarkers=function(e){var n=this.getMarkers();n.length&&(this.range.setStartBefore(n[0]),this.range.setEndAfter(n.length>=2?n[1]:n[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(this.range))},n.prototype.isCaretOnNewLine=function(){var e=this.getContaining(function(e){return"P"===e.nodeName});if(e){var n=e.innerHTML.trim();return"P"===e.nodeName&&("<br>"===n||""===n)}return!1},n}}(),n.api_simple_command=function(){return function(e,n){function t(e,t){n.api.Command.call(this,e),this.nodeName=t}return t.prototype=Object.create(e.Command.prototype),t.prototype.constructor=t,t.prototype.queryState=function(){var e=new n.api.Selection;return n.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},t}}(),n.api=function(e,n,t,r,o,i){return function(a){this.CommandPatch=e(a),this.Command=n(a),this.Element=t,this.Node=r,this.Selection=o(a),this.SimpleCommand=i(this,a)}}(n.api_command_patch,n.api_command,n.api_element,n.api_node,n.api_selection,n.api_simple_command),n.lodash_modern_objects_assign=function(e,n,t){var r=function(r,o,i){var a,s=r,c=s;if(!s)return c;var u=arguments,l=0,d="number"==typeof i?2:u.length;if(d>3&&"function"==typeof u[d-2])var m=e(u[--d-1],u[d--],2);else d>2&&"function"==typeof u[d-1]&&(m=u[--d]);for(;++l<d;)if(s=u[l],s&&t[typeof s])for(var p=-1,f=t[typeof s]&&n(s),_=f?f.length:0;++p<_;)a=f[p],c[a]=m?m(c[a],s[a]):s[a];return c};return r}(n.lodash_modern_internals_baseCreateCallback,n.lodash_modern_objects_keys,n.lodash_modern_internals_objectTypes),n.transaction_manager=function(e){return function(n){function t(){this.history=[]}return e(t.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(n.pushHistory(),n.trigger("content-changed"))},run:function(e){this.start();try{e&&e()}finally{this.end()}}}),t}}(n.lodash_modern_objects_assign),n.undo_manager=function(){return function(e){function n(){this.position=0,this.stack=[],this.debug=e.isDebugModeEnabled()}return n.prototype.maxStackSize=100,n.prototype.push=function(e){for(this.debug&&console.log("UndoManager.push: %s",e),this.stack.length=++this.position,this.stack.push(e);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},n.prototype.undo=function(){return this.position>1?this.stack[--this.position]:void 0
},n.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},n}}(),n.scribe=function(e,n,t,r,o,i,a,s,c,u,l,d){function m(e,m){this.el=e,this.commands={},this.options=n(m||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this.plainTextFormatter=new p,this.htmlFormatter=new p,this.api=new u(this);var f=l(this);this.transactionManager=new f;var _=d(this);this.undoManager=new _,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.use(this.allowsBlockElements()?c():a()),this.use(i()),this.use(o()),this.use(s.commands.bold()),this.use(s.commands.indent()),this.use(s.commands.insertHTML()),this.use(s.commands.insertList()),this.use(s.commands.outdent()),this.allowsBlockElements()&&this.use(s.emptyWhenDeleting()),this.use(s.events()),this.use(t.indent()),this.use(t.insertHTML()),this.use(t.insertList()),this.use(t.outdent()),this.use(t.redo()),this.use(t.undo()),this.use(r());var h=function(){setTimeout(function(){this.pushHistory()}.bind(this),0),this.el.removeEventListener("focus",h)}.bind(this);this.el.addEventListener("focus",function(){function e(n){var t=document.createTreeWalker(n),r=t.currentNode;return t.firstChild()?"BR"===t.currentNode.nodeName?r:e(t.currentNode):t.currentNode}var n=new this.api.Selection;if(n.range){n.placeMarkers();var t=this.allowsBlockElements()&&this.getHTML().match(/^<em class="scribe-marker"><\/em>/);if(n.removeMarkers(),t){var r=e(this.el.firstChild),o=n.range;o.setStart(r,0),o.setEnd(r,0),n.selection.removeAllRanges(),n.selection.addRange(o)}}}.bind(this)),this.el.addEventListener("focus",h)}function p(){this.formatters=[]}return m.prototype=Object.create(e.prototype),m.prototype.use=function(e){return e(this),this},m.prototype.setHTML=function(e){this.el.innerHTML=e},m.prototype.getHTML=function(){return this.el.innerHTML},m.prototype.getContent=function(){return this.getHTML().replace(/<br>$/,"")},m.prototype.getTextContent=function(){return this.el.textContent},m.prototype.pushHistory=function(){var e=this.undoManager.stack[this.undoManager.position],n=e&&e.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!e||e&&this.getContent()!==n){var t=new this.api.Selection;t.placeMarkers();var r=this.getHTML();return t.removeMarkers(),this.undoManager.push(r),!0}return!1},m.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},m.prototype.restoreFromHistory=function(e){this.setHTML(e);var n=new this.api.Selection;n.selectMarkers(),this.trigger("content-changed")},m.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},m.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(this.htmlFormatter.format(e)),this.trigger("content-changed")},m.prototype.insertPlainText=function(e){this.insertHTML("<p>"+this.plainTextFormatter.format(e)+"</p>")},m.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this.htmlFormatter.format(e))},m.prototype.isDebugModeEnabled=function(){return this.options.debug},p.prototype.format=function(e){var n=this.formatters.reduce(function(e,n){return n(e)},e);return n},m}(n.event_emitter,n.lodash_modern_objects_defaults,n.plugins_core_commands,n.plugins_core_events,n.plugins_core_formatters_html_replace_nbsp_chars,n.plugins_core_formatters_plain_text_escape_html_characters,n.plugins_core_inline_elements_mode,n.plugins_core_patches,n.plugins_core_set_root_p_element,n.api,n.transaction_manager,n.undo_manager);var t=n.scribe;"function"==typeof define&&define.amd?define(["scribe"],function(){return e.Scribe=t}):"object"==typeof exports?module.exports=t:e.Scribe=t}(this);//# sourceMappingURL=scribe.min.js.map